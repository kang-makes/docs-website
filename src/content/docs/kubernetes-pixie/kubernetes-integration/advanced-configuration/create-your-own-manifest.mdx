---
title: Create your own manifest file
tags:
  - Integrations
  - Kubernetes integration
  - Installation
metaDescription: How to create a manifest using Helm as a templating system
---

We are not templating manifest anymore because they are prone to errors and leave orphaned objects, for example, when a name
of the object change. But your governance on how/what/why is something deployed on your cluster could collide with using Helm,
(like pipeline, security tooling or using other templating system on top of manifests) so you need to have a manifest to
install out integration.

As we integrate many integrations, it is really difficult to document all the possibilities that we have. An good example is
configuring our integration to [use a proxy](/docs/integrations/kubernetes-integration/installation/configure-kubernetes-proxy.

While in Helm is trivial, just setting `global.proxy` to the proxy you want to use. In some integrations we template the proxy
inside the integration's config YAML, in the config of the sidecar infrastructure agent, or in the integration itself as
an environment variable.

This guide will cover how to create your own manifest using Helm for you can upgrade your manifests and modify them to your
needs. To be able to understand all the power of Helm, we recommend you to read [how to install Kubernetes integration using Helm](http://localhost:8000/docs/kubernetes-pixie/kubernetes-integration/installation/install-kubernetes-integration-using-helm)
prior to this guide.

## Compatibility and requirements [#compatibility]

Make sure [Helm](https://github.com/helm/helm#install) is installed on your machine. Version 3 of the Kubernetes Integration requires Helm version 3.

You will need your New Relic account license key and your Kubernetes cluster's name:

1. Find and copy your [New Relic license key](/docs/accounts/install-new-relic/account-setup/license-key).
2. Choose a display name for your cluster. For example, you could use the output of:

```shell
kubectl config current-context
```

Note these values somewhere safe, as you will need them later during the templating process.

## Templating Kubernetes integration with Helm [#install-k8-helm]

<Callout
  variant="important"
>
  Installing and upgrading using a manifest is not a supported method and is prone to errors. Be completely sure that this is the approach
  you really need for your environment.
</Callout>

1. Add the New Relic Helm charts repo:

```shell
helm repo add newrelic https://helm-charts.newrelic.com
```

2. Create a file named `values-newrelic.yaml`, which will be used to define your configuration:

Refer to the helm installing documentation to know [how to configure it](https://docs.newrelic.com/docs/kubernetes-pixie/kubernetes-integration/installation/install-kubernetes-integration-using-helm/#configure)

This is an example of a valid `values.yaml`:

```yaml
global:
  licenseKey: _YOUR_NEW_RELIC_LICENSE_KEY_
  cluster: _K8S_CLUSTER_NAME_

newrelic-prometheus-agent:
  # Automatically scrape prometheus metrics for annotated services in the cluster
  enabled: true
nri-metadata-injection:
  # Deploy our webhook to link APM and Kubernetes entities
  enabled: true
nri-kube-events:
  # Report Kubernetes events
  enabled: true
newrelic-logging:
  # Report logs for containers running in the cluster
  enabled: true
kube-state-metrics:
  # Deploy kube-state-metrics in the cluster.
  # Set this to true unless it is already deployed.
  enabled: true
```

3. Make sure everything is configured properly in the chart by running the following command. Notice that we are specifying `--dry-run` and `--debug`, so nothing will be installed in this step:

```shell
helm upgrade --install newrelic newrelic/nri-bundle \
--namespace newrelic --create-namespace \
-f values-newrelic.yaml \
--dry-run \
--debug
```

Please notice and adjust the following values:

* `global.licenseKey=YOUR_NEW_RELIC_LICENSE_KEY`: Must be set to a valid License Key for your account.
* `global.cluster=K8S_CLUSTER_NAME`: Is used to identify the cluster in the New Relic UI, so should be a descriptive value not used by any other Kubernetes cluster configured in your New Relic account.
* `kube-state-metrics.enabled=true`: Setting this to `true` will automatically install Kube State Metrics (KSM) for you, which is required for our integration to run. You can set this to false if KSM is already present in your cluster, even if it is on a different namespace.
* `newrelic-prometheus-agent.enabled=true`: Will deploy our Prometheus Agent, which automatically collects data from Prometheus endpoints present in the cluster.
* `nri-metadata-injection.enabled=true`: Will install our minimal webhook, which adds environment variables that, in turn, allows [linking applications instrumented with New Relic APM to Kubernetes](/docs/kubernetes-pixie/kubernetes-integration/link-your-applications/link-your-applications-kubernetes).

Our Kubernetes charts have a comprehensive set of flags and tunables that can be edited to better fit your particular needs. Please check the [Configure the integration](#configure) section below to see what can be changed.

4. Template the Kubernetes integration by running this command:

```shell
helm template newrelic newrelic/nri-bundle \
--namespace newrelic --create-namespace \
-f values-newrelic.yaml > templated-nri-bundle.yaml
```

5. Apply the manifest generated

```shell
kubectl -n newrelic apply -f templated-nri-bundle.yaml
```

## Upgrade using Manifest [#upgrade]

<Callout
  variant="important"
>
  Installing and upgrading using a manifest is not a supported method and is prone to errors. Be completely sure that this is the approach
  you really need for your environment.
</Callout>

1. Update the local chart repository:

```shell
helm repo update
```

2. Template the file again

```shell
helm template newrelic newrelic/nri-bundle \
--namespace newrelic --create-namespace \
-f values-newrelic.yaml > new-templated-nri-bundle.yaml
```

3. Uninstall the previous version using the previous manifest and apply the new one:
```
kubectl -n newrelic delete -f templated-nri-bundle.yaml
kubectl -n newrelic apply -f new-templated-nri-bundle.yaml
```

## Uninstall Kubernetes integration [#uninstall]

To uninstall the Kubernetes integration using Helm, run the following command:

```shell
kubectl -n newrelic delete -f templated-nri-bundle.yaml
```
