---
title: Migrate from Prometheus OpenMetrics Integration
tags:
  - Integrations
  - Prometheus integrations
  - Install and configure OpenMetrics
metaDescription: Migration guidelines to move from Prometheus OpenMetrics to New Relic Prometheus Agent.
---

If you're using our [Prometheus OpenMetrics integration](/docs/infrastructure/prometheus-integrations/install-configure-openmetrics/install-update-or-uninstall-your-prometheus-openmetrics-integration), `nri-prometheus`, you can migrate to [New Relic's Prometheus agent](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/install-prometheus-agent), `newrelic-prometheus-agent`, to achieve the same monitoring experience.

Since the `newrelic-prometheus-agent` is actually running the `Prometheus server` in agent mode, the configuration file structure has changed to offer more flexibility and the possibility to use any scrape related feature of the Prometheus server, such as authorization methods and relabel configuration setups.

We translate our simplified configuration file to a prometheus server configuration file, to give you an easier configuration experience. We suggest that you read the documentation to be able to better follow this migration guide. See how to [set up New Relic's Prometheus agent](/docs/integrations/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent).

## Keep Prometheus OpenMetrics integration during the migration

You can select what you want to keep installed [Configuring the integration using Helm](/docs/kubernetes-pixie/kubernetes-integration/installation/install-kubernetes-integration-using-helm/#configure).

In that way you can keep only `nri-prometheus`, `newrelic-prometheus-agent` or both installed. An example of keeping both installed is by setting your [`values.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/nri-bundle/values.yaml) like this:
```yaml
nri-metadata-injection:
  enabled: true

newrelic-prometheus-agent:
  enabled: true
```

<Callout
  variant="important"
>
  With the default configuration you will have duplicated data and will be charged twice. You have to configure Prometheus Agent [discovery target](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent#k8s-target-discovery) to limit what the agent is going to discover.
</Callout>

While keeping both of the integrations installed at the same time, you can use [filters](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent#drop-keep-metrics) while adapting your dashboards and alerts.

## Dashboards and alerts [#migration]

The metrics are sent in the same way that they were sent using `nri-prometheus` but you will need to change some metadata that has changed between `nri-prometheus` and `newrelic-prometheus-adapter`.

<Callout variant="tip">
  Read the full list of labels added by the Prometheus agent [here](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/default-metrics-and-metric-attributes#metric-labels).
</Callout>

### Metadata renamed [#metadata-renamed]

The following table highlights the metadata renamed between `nri-prometheus` and `newrelic-prometheus-agent`:

<table>
  <thead>
    <tr>
      <th style={{ width: "280px" }}>nri-prometheus</th>
      <th style={{ width: "300px" }}>newrelic-prometheus-agent</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>`namespaceName`</td>      <td>`namespace`</td>
    </tr>
    <tr>
      <td>`nodeName`</td>           <td>`node`</td>
    </tr>
    <tr>
      <td>`podName`</td>            <td>`pod`</td>
    </tr>
    <tr>
      <td>`serviceName`</td>        <td>`service`</td>
    </tr>
    <tr>
      <td>`deploymentName`</td>     <td>`-`</td>
    </tr>
    <tr>
      <td>`clusterName`</td>        <td>`cluster_name`</td>
    </tr>
    <tr>
      <td>`scrapedTargetKind`</td>  <td>`job`</td>
    </tr>
    <tr>
      <td>`scrapedTargetName`</td>  <td>`instance`</td>
    </tr>
  </tbody>
</table>

Notes:
 - `scrapedTargetKind` has been changed to `job` and can be sued to identify the scrape kind
 - `scrapedTargetName` has been changed to `instance` and contains the `host:port` for the target.

A special mention to `label.kubernetesLabel`:

To comply with the [Prometheus DataModel](https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels), Kubernetes label names are sanitized after scraped to replace any unsupported character to `_`. For example, the Kubernetes label `k8s.io/app` is added as `k8s_io_app`. The `label.` prefix has been removed. The value of the label remains unchanged.

### Metadata [#metadata-removed]

The following table highlights the metadata removed between `nri-prometheus` and `newrelic-prometheus-agent` and has no
attribute to subsitute it:

<table>
  <thead>
    <tr>
      <th style={{ width: "280px" }}>nri-prometheus</th>
      <th style={{ width: "300px" }}>newrelic-prometheus-agent</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>`deploymentName`</td>     <td>`-`</td>
    </tr>
    <tr>
      <td>`integrationName`</td>    <td>`-`</td>
    </tr>
    <tr>
      <td>`integrationVersion`</td> <td>`-`</td>
    </tr>
    <tr>
      <td>`metricName`</td>         <td>`-`</td>
    </tr>
    <tr>
      <td>`nrMetricType`</td>       <td>`-`</td>
    </tr>
    <tr>
      <td>`promMetricType`</td>     <td>`-`</td>
    </tr>
    <tr>
      <td>`targetName`</td>         <td>`-`</td>
    </tr>
    <tr>
      <td>`scrapedTargetName`</td>  <td>`-`</td>
    </tr>
  </tbody>
</table>

## Kubernetes target discovery [#K8s-target-discovery]

We've improved the target discovery configuration by adding `Jobs`. See how to [configure Kubernetes target discovery](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent#k8-target-discovery).

Default behaviors have changed between Prometheus OpenMetrics and the Prometheus agent. While, by default, Prometheus OpenMetrics scrapes pods and services containing `prometheus.io/scrape=true` as a label or annotation, the Prometheus agent scrapes pods and endpoints from services containing `prometheus.io/scrape=true` as an **annotation only**.

Node metrics are no longer scraped by default in the Prometheus agent, as it may cause metric duplication since it's normally used by New Relic's kubernetes integration.

## Metric types [#metric-types]

Prometheus OpenMetrics, `nri-prometheus`, as a custom solution, converts Prometheus metrics to New Relic metrics before sending them, by applying [mappings](/docs/infrastructure/prometheus-integrations/view-query-data/translate-promql-queries-nrql#compare) according to the metric metadata type reading from the scraped data: `# TYPE <metric_type>`.

On the Prometheus agent, `newrelic-prometheus-agent`, which leverages a standard Prometheus server, metrics are sent directly to the New Relic's remote write endpoint, which handles this conversion based on metric names. Some metrics may not be properly converted by the remote write endpoint:

- Prometheus Counter metrics **without** the name suffix `total`, `count`, `sum`, or `bucket` will be converted as **Gauge**.
- Prometheus Gauge metrics **with** the name suffix `total`, `count`, `sum`, or `bucket` will be converted as **Counter**.

To fix this, you can set up metric type mappings relabel options.

## Transformations [#transformations]

Prometheus OpenMetrics, `nri-prometheus`, transformations are now replaced with Prometheus relabel configurations. See a list of [examples of relabel configuration setups](/docs/infrastructure/prometheus-integrations/install-configure-prometheus-agent/setup-prometheus-agent#metric-label-transformations).

## Self-instrumentation [#self-instrumentation]

Similar to Prometheus OpenMetrics (`nri-prometheus`), the Prometheus agent (`newrelic-prometheus-agent`) self-scrapes internal metrics. These metrics have the `prometheus_` prefix and you can use them to observe the status of the Prometheus instance. By default, only a reduced set of these metrics are sent. You can find the list of metrics on the [default values.yaml file](https://github.com/newrelic/newrelic-prometheus-configurator/blob/main/charts/newrelic-prometheus-agent/values.yaml) of the chart, by searching for `job_name: self-metrics`.

We also give you a curated dashboard for self-metrics with performance and health information, and also metrics volume sent. Install the quickstart containing the [dashboard for the Prometheus agent](https://newrelic.com/instant-observability/prometheus-agent) in your New Relic account.
